# NTUHPharmGame - 上下文共享

> 最後更新：2026-02-12 by Codex (GPT-5)

## 基本規範

- **此專案使用 Git 版本控制**
- 所有變更應有適當的 commit

## Git 歷史

```
* 9f81a57 fix: 前台遊戲同步 cabinetConfig 動態渲染 + 補齊 13 張藥品圖片
* c9660dc feat: 套用 Patch1 更新 A/B/C 櫃藥品位置與屬性
* a26e322 fix: 後台 boxSize 欄位允許留白
* 2ebac05 docs: 新增 EdTech Support 藥劑部_AG 補丁更新 0129 的筆記
* b2bd47c 更新 .shared-ai-context
* ff9fcaa feat: 新增變更歷程追蹤與意見回饋欄位
* e99e5f8 simplify: 移除後台圖片替換功能，簡化發布機制
* 0901192 fix: 修正發布功能 localStorage 容量問題
* 4457b42 feat: 完成後台藥品照片替換功能與發布機制
* bc50a5f refactor: 抽離 drugDatabase 至 drug_data.js，遊戲改引用外部資料
* 9711057 feat: 新增藥品櫃位管理後台 admin.html
* 2805726 修正配藥計數器歸零與抽屜藥品選取邏輯
* af9842e 加強換題時的高亮清除邏輯
* c33be12 修正抽屜預覽只顯示第一排藥品
* 4829869 修正抽屜藥物點擊事件冒泡問題
* 4229ade feat: 新增 reload.html 快取清除重新導向
* fdb7b54 修正 Denosin 與 Doxaben 2mg 藥品照片
* c7eb8d8 新增 .shared-ai-context 上下文共享檔案
* c5e332f 新增遊戲控制功能與 UI 修正
* 31b58c3 新增參考文件 (20260129 版)
* 3ac92b7 修正 I1/H1/G1 櫃位藥品分配
* 3be07ec 修正 J1 抽屜藥品位置
* 4dea4c8 更新下排櫃位藥品位置 (J/I/H/G/E/F)
* 956a369 更新調劑遊戲 v20260129
* edf8f07 新增 Netlify 部署連結至 README
* 035d4e9 修正計數器重置邏輯：確認位置後歸零
* b2d9866 動態更新藥品規格資訊顯示
```

## 更新規則

**每位 AI 助手完成工作後，必須更新此檔案：**
- 新增/修改檔案 → 更新相關區塊
- 任何變更 → 在「變更日誌」新增紀錄
- 有新 commit → 更新「Git 歷史」區塊

格式：`[日期] [AI名稱]: 變更摘要`

---

## 專案資訊

### 專案說明
台大醫院藥劑部門診配藥訓練遊戲，用於訓練藥師熟悉藥品位置和配藥流程。

### 技術棧
- 純 HTML/CSS/JavaScript 單頁應用
- Netlify 自動部署 (從 GitHub main 分支)

### 主要檔案結構
```
.
├── dispensing-game.html    # 主遊戲檔案
├── admin.html              # 藥品櫃位管理後台
├── drug_data.js             # 共用藥品資料庫 (cabinetConfig + drugDatabase)
├── drug_map.js             # 藥品名稱到照片路徑映射
├── Reference/
│   └── DrugData/Images/    # 145 張藥品照片
└── patch update 0129/      # 位置參考文件 (Word/PDF)
```

### 藥品資料結構
```javascript
{
  name: "藥品名稱",
  cabinet: "A-J 或 Desktop",
  section: "drawer1/drawer2/doorL/doorR" (僅下排櫃),
  row: 1-4,
  col: 1-3,
  stripSize: 一排數量,
  boxSize: 一盒數量 (選填，留白表示未知),
  isBox: true/false (選填),
  unit: "盒/束/包" (選填，自訂包裝單位),
  colSpan: 2 (選填，藥品占用格數)
}
```

### 參考資源
- NTUH 藥劑部藥品查詢: https://www.ntuh.gov.tw/phr/Fpage.action?muid=2077&fid=1939

---

## 變更日誌

- [2026-02-12] Codex (GPT-5): 修正前台 `updateDrugImage()` 缺失造成的 runtime error；配藥題目產生器改為容錯（`boxSize` 缺值不再產生 `NaN/undefined`）；修正 `drug_data.js` 櫃位 config（J/I/H/G 抽屜 5x3、E/F 抽屜 6x3、門 1x2、Desktop 1x5）；後台匯出改為僅在 `boxSize` 有效時輸出，避免 `boxSize: undefined` 汙染資料。
- [2026-02-11] Claude Opus 4.6: 前台遊戲同步 cabinetConfig（B 櫃 7 列、E/F 抽屜 6 列、unit/colSpan 支援）+ 補齊 13 張藥品圖片
- [2026-02-11] Claude Opus 4.6: 套用 Patch1 更新 A/B/C 櫃藥品位置與屬性、更新 drug_map.js 圖片映射、修復後台 saveModal unit/colSpan 儲存邏輯
- [2026-02-09] Claude Opus 4.6: 新增變更歷程追蹤面板與意見回饋欄位，匯出時附帶歷程
- [2026-02-09] Claude Opus 4.6: 移除後台圖片替換功能（localStorage 容量限制）
- [2026-02-09] Claude Opus 4.6: 抽離 drugDatabase 至 drug_data.js，新增 admin.html 後台管理面板
- [2026-02-09] Claude Opus 4.6: 修正配藥換題計數器未歸零、抽屜藥品點擊後觸發選取邏輯
- [2026-02-05] Claude Opus 4.5: 修正 Denosin 與 Doxaben 2mg 藥品照片
- [2026-02-05] Claude Opus 4.5: 新增暫停/重新開始按鈕、修正放大視窗藥物點擊、位置提示自動清除、Eurodin 位置校正 (H1→G1)
