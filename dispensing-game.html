<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âè∞Â§ßËó•ÂäëÈÉ® - Ë™øÂäëË®ìÁ∑¥ÈÅäÊà≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Ëó•Ê´É‰∏ªÂçÄÂüü */
        .cabinet-area {
            background: #eceff1;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        /* ========== ‰∏≠ÈñìÈÅäÊà≤ÂçÄÊï¥ÂêàÊ®£Âºè ========== */
        .center-game-zone {
            flex: 2;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border: 3px solid #fbc02d;
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 300px;
        }

        .compact-header {
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            color: #5d4037;
        }

        .version-tag {
            font-size: 0.7rem;
            background: #8d6e63;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .compact-stats {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .mini-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            background: white;
            padding: 4px 10px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 0.85rem;
        }

        .stat-val {
            font-weight: bold;
            font-size: 1rem;
        }

        .stat-val.time {
            color: #e74c3c;
        }

        .stat-val.score {
            color: #27ae60;
        }

        .stat-val.combo {
            color: #f39c12;
        }

        .mode-selector-compact {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .mode-btn-sm {
            padding: 5px 12px;
            border: none;
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .mode-btn-sm.location {
            background: #3498db;
            color: white;
        }

        .mode-btn-sm.dispensing {
            background: #27ae60;
            color: white;
        }

        .mode-btn-sm.rush {
            background: #e74c3c;
            color: white;
        }

        .mode-btn-sm:hover {
            transform: scale(1.05);
        }

        .mode-btn-sm.active {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .mode-divider {
            color: #ccc;
            margin: 0 5px;
            font-weight: bold;
        }

        .game-ctrl-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .game-ctrl-btn.pause {
            background: #ff9800;
            color: white;
        }

        .game-ctrl-btn.pause.paused {
            background: #4caf50;
        }

        .game-ctrl-btn.restart {
            background: #9e9e9e;
            color: white;
        }

        .game-ctrl-btn:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        .prescription-compact {
            background: white;
            border-radius: 8px;
            padding: 6px 10px;
        }

        .prescription-compact.position-ok {
            outline: 2px solid rgba(76, 175, 80, 0.9);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.15);
        }

        /* ÈÖçËó•/Ê∏¨Ë©¶Ê®°ÂºèÔºöÂ∞èÊèêÁ§∫Ôºà‰∏çË∑≥ÁΩÆ‰∏≠Ë¶ñÁ™óÔºâ */
        .inline-hint {
            margin-top: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            text-align: center;
            padding: 4px 8px;
            border-radius: 6px;
            display: none;
            line-height: 1.2;
        }

        .inline-hint.show {
            display: block;
        }

        .inline-hint.correct {
            color: #2e7d32;
            background: rgba(76, 175, 80, 0.12);
            border: 1px solid rgba(76, 175, 80, 0.45);
        }

        .inline-hint.wrong {
            color: #c62828;
            background: rgba(244, 67, 54, 0.12);
            border: 1px solid rgba(244, 67, 54, 0.45);
        }

        /* Ê°åÈù¢ÂçÄÂ∏∏ÂÇôËó•ÔºàBiocal / Coxine / Sennapur / LoditonÔºâ */
        .desktop-drug-pool {
            margin-top: 6px;
            background: rgba(255, 255, 255, 0.65);
            border-radius: 8px;
            padding: 6px 8px;
            border: 1px dashed rgba(93, 64, 55, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .desktop-drug-pool-label {
            font-size: 0.75rem;
            color: #5d4037;
            font-weight: bold;
            flex: 0 0 auto;
        }

        .desktop-drug-pool-items {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
            flex: 0 1 auto;
        }

        .desktop-drug-pool .draggable-drug {
            font-size: 0.7rem;
            padding: 4px 8px;
            cursor: pointer;
        }

        /* ÂÆö‰ΩçÊ®°ÂºèÔºöÁΩÆ‰∏≠È°ØÁ§∫ */
        .location-mode-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .drug-name-compact {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .drug-hint-compact {
            font-size: 0.75rem;
            color: #666;
        }

        /* ÈÖçËó•Ê®°ÂºèÔºöÊ∞¥Âπ≥ÊéíÂàó */
        .dispensing-mode-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
            width: 100%;
        }

        .dispensing-mode-row .drug-name-compact {
            flex: 1 1 auto;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .quantity-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .spec-badge {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .counter-group {
            display: flex;
            gap: 8px;
            align-items: center;
            flex: 0 0 auto;
        }

        .counter-item {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .counter-minus {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1px solid #ccc;
            background: #f5f5f5;
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }

        .counter-minus:hover {
            background: #e0e0e0;
        }

        .counter-minus:active {
            background: #d0d0d0;
        }

        .counter-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.15s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .counter-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }

        .counter-circle:active {
            transform: scale(0.95);
        }

        .counter-label {
            font-size: 0.7rem;
            color: #555;
            min-width: 14px;
        }

        .submit-btn-sm {
            padding: 6px 12px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn-sm:hover {
            background: #219a52;
            transform: scale(1.05);
        }

        .section-label {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        /* ========== ‰∏äÊéíÔºöC - B - A ÈñãÊîæÂºèÊû∂Â≠ê ========== */
        .top-shelf-row {
            display: flex;
            gap: 8px;
            justify-content: stretch;
            align-items: stretch;
            margin-bottom: 15px;
            padding: 0;
            width: 100%;
        }

        .shelf-cabinet {
            background: linear-gradient(180deg, #a1887f 0%, #8d6e63 100%);
            border-radius: 8px;
            padding: 8px;
            flex: 1;
            min-width: 0;
            border: 3px solid #5d4037;
            display: flex;
            flex-direction: column;
        }

        .shelf-cabinet .shelf-grid {
            flex: 1;
            align-content: stretch;
        }

        .shelf-cabinet .cab-label {
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            background: #4e342e;
            border-radius: 4px;
            padding: 4px;
            letter-spacing: 2px;
        }

        .shelf-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px;
        }

        /* ========== ‰∏ãÊéíÔºöJ - I - H - G - E - F ÊäΩÂ±úÊ´É ========== */
        .bottom-cabinet-row {
            display: flex;
            gap: 8px;
            justify-content: stretch;
            padding: 0;
            width: 100%;
        }

        .drawer-cabinet {
            background: linear-gradient(180deg, #8d6e63 0%, #6d4c41 100%);
            border-radius: 8px;
            padding: 8px;
            flex: 1;
            min-width: 0;
            border: 3px solid #4e342e;
            display: flex;
            flex-direction: column;
        }

        /* Hover effects for Zoom interaction */
        .shelf-cabinet,
        .drawer-section,
        .door {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .shelf-cabinet:hover,
        .drawer-section:hover,
        .door:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
            z-index: 5;
            position: relative;
        }

        /* Continuous Hint Styling */
        .cabinet-hint-active {
            box-shadow: 0 0 0 4px #ffc107, 0 0 20px #ffc107 !important;
            animation: pulse-border 1.5s infinite;
        }

        @keyframes pulse-border {
            0% {
                box-shadow: 0 0 0 4px #ffc107;
            }

            50% {
                box-shadow: 0 0 0 8px rgba(255, 193, 7, 0.5);
            }

            100% {
                box-shadow: 0 0 0 4px #ffc107;
            }
        }

        .drawer-cabinet .cab-label {
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 6px;
            background: #3e2723;
            border-radius: 4px;
            padding: 4px;
            letter-spacing: 2px;
        }

        /* ÊäΩÂ±úÂçÄ (‰∏äÂçäÈÉ®) */
        .drawer-section {
            margin-bottom: 6px;
        }

        .drawer-label {
            font-size: 0.65rem;
            color: #d7ccc8;
            text-align: center;
            margin-bottom: 3px;
            font-weight: bold;
        }

        .drawer-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            background: #5d4037;
            padding: 5px;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        /* ÈõôÈñãÈñÄÂçÄ (‰∏ãÂçäÈÉ®) */
        .door-section {
            display: flex;
            gap: 6px;
        }

        .door {
            flex: 1;
            background: #4e342e;
            border-radius: 5px;
            padding: 5px;
            border: 2px solid #3e2723;
            min-width: 0;
        }

        .door-label {
            font-size: 0.6rem;
            color: #bcaaa4;
            text-align: center;
            margin-bottom: 3px;
            font-weight: bold;
        }

        .door-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
        }

        /* Ëó•ÂìÅÊ†ºÂ≠ê */
        .drug-slot {
            background: #efebe9;
            border-radius: 3px;
            min-height: 32px;
            cursor: grab;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            padding: 2px;
            text-align: center;
            color: #333;
            border: 2px solid transparent;
            line-height: 1.15;
            position: relative;
            user-select: none;
        }

        .drug-slot.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .drug-slot:hover {
            background: #bbdefb;
            transform: scale(1.05);
            z-index: 10;
        }

        .drug-slot.correct {
            background: #a5d6a7;
            border-color: #4caf50;
            animation: pulse 0.5s;
        }

        .drug-slot.wrong {
            background: #ef9a9a;
            border-color: #f44336;
            animation: shake 0.5s;
        }

        .drug-slot.highlight {
            background: #fff59d;
            border-color: #ffc107;
            animation: glow 1s infinite;
        }

        .drug-slot.box::after {
            content: 'Áõí';
            font-size: 0.45rem;
            color: #e65100;
            position: absolute;
            bottom: 0;
            right: 1px;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-4px);
            }

            75% {
                transform: translateX(4px);
            }
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 5px #ffc107;
            }

            50% {
                box-shadow: 0 0 15px #ffc107;
            }
        }

        /* Ê°åÈù¢ÂçÄ - Â∑•‰ΩúÂçÄÂüü */
        .desktop-area-container {
            display: flex;
            gap: 12px;
            margin: 12px 0;
            padding: 10px;
            background: linear-gradient(180deg, #bcaaa4 0%, #a1887f 100%);
            border-radius: 10px;
            border: 2px solid #8d6e63;
            min-height: 120px;
            align-items: stretch;
        }

        .drop-zone {
            flex: 1;
            min-height: 100px;
            background: #efebe9;
            border-radius: 8px;
            border: 3px dashed #8d6e63;
            padding: 8px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }

        .drop-zone.drag-over {
            background: #c8e6c9;
            border-color: #4caf50;
            border-style: solid;
        }

        .drop-zone-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: #5d4037;
            margin-bottom: 6px;
            text-align: center;
            padding: 3px 6px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 4px;
        }

        .drop-zone-content {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-content: flex-start;
            min-height: 40px;
        }

        .left-hand-zone {
            border-color: #1976d2;
        }

        .left-hand-zone .drop-zone-label {
            color: #1565c0;
        }

        .left-hand-zone.drag-over {
            background: #bbdefb;
            border-color: #1976d2;
        }

        .right-hand-zone {
            border-color: #c62828;
        }

        .right-hand-zone .drop-zone-label {
            color: #c62828;
        }

        .right-hand-zone.drag-over {
            background: #ffcdd2;
            border-color: #c62828;
        }

        .draggable-drug {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border: 2px solid #fbc02d;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.75rem;
            cursor: grab;
            user-select: none;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .draggable-drug:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .draggable-drug.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .draggable-drug.in-left {
            background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%);
            border-color: #1976d2;
        }

        .draggable-drug.in-right {
            background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
            border-color: #c62828;
        }

        /* ÂõûÈ•ãË®äÊÅØ */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 25px 45px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            z-index: 1000;
            display: none;
            animation: fadeInOut 1.2s;
        }

        .feedback.correct {
            background: #4caf50;
            color: white;
        }

        .feedback.wrong {
            background: #f44336;
            color: white;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* ÈñãÂßãÁï´Èù¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .start-screen h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .start-screen p {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .start-btn {
            padding: 18px 50px;
            font-size: 1.3rem;
            background: #fff;
            color: #667eea;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .start-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .start-screen.hidden {
            display: none;
        }

        /* ÁµêÊûúÁï´Èù¢ */
        .result-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .result-screen.active {
            display: flex;
        }

        .result-card {
            background: white;
            padding: 35px;
            border-radius: 15px;
            text-align: center;
            max-width: 420px;
        }

        .result-card h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #333;
        }

        .result-stats p {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #555;
        }

        .result-stats .highlight {
            color: #27ae60;
            font-weight: bold;
        }

        .retry-btn {
            padding: 12px 35px;
            font-size: 1.1rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* ========== ÊîæÂ§ßË¶ñÁ™óÊ®£Âºè ========== */
        .zoom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .zoom-modal.active {
            display: flex;
        }

        .zoom-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 85%;
            max-height: 85vh;
            overflow: auto;
            position: relative;
        }

        .zoom-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .zoom-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .zoom-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .zoom-close:hover {
            background: #c0392b;
        }

        .zoom-grid {
            display: grid;
            gap: 10px;
            margin-top: 12px;
        }

        .zoom-grid.shelf-layout {
            grid-template-columns: repeat(6, 1fr);
        }

        .zoom-grid.drawer-layout {
            grid-template-columns: repeat(3, 1fr);
        }

        .zoom-grid.door-layout {
            grid-template-columns: repeat(2, 1fr);
        }

        .zoom-drug-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            min-height: 85px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .zoom-drug-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .zoom-drug-card.box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-color: #f39c12;
        }

        .zoom-drug-card.empty {
            background: #ecf0f1;
            border-color: #bdc3c7;
            cursor: default;
        }

        .zoom-drug-card.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .zoom-drug-name {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 6px;
        }

        .zoom-drug-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .zoom-drug-location {
            font-size: 0.75rem;
            color: #3498db;
            margin-top: 4px;
            font-weight: 500;
        }

        .zoom-section-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            margin-top: 12px;
            color: #2c3e50;
        }

        .zoom-section-title:first-child {
            margin-top: 0;
        }

        /* ËÆìÊ´É‰ΩçÊ®ôÁ±§ÂíåÊäΩÂ±úÊ®ôÁ±§ÂèØÈªûÊìä */
        .cab-label,
        .drawer-label {
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }

        .cab-label:hover,
        .drawer-label:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .cab-label::after,
        .drawer-label::after {
            content: ' üîç';
            font-size: 0.8em;
            opacity: 0.6;
        }

        /* ========== ÊèêÁ§∫Ê®°ÂºèÊ®£Âºè ========== */
        .hint-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .hint-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hint-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .hint-toggle.active {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .show-hint-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .show-hint-btn:hover {
            transform: scale(1.05);
            background: #2980b9;
        }

        .show-hint-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* ÈñÉÁàçÂãïÁï´ */
        @keyframes blink-highlight {

            0%,
            100% {
                background: #f1c40f;
                transform: scale(1);
                box-shadow: 0 0 20px rgba(241, 196, 15, 0.8);
            }

            50% {
                background: #e74c3c;
                transform: scale(1.1);
                box-shadow: 0 0 30px rgba(231, 76, 60, 1);
            }
        }

        .slot-blinking {
            animation: blink-highlight 1s ease-in-out 3;
            z-index: 100;
        }

        /* RWD */
        @media (max-width: 1400px) {
            .drawer-cabinet {
                padding: 6px;
            }

            .door-grid {
                gap: 2px;
            }

            .center-game-zone {
                min-width: 250px;
            }
        }

        @media (max-width: 1200px) {
            .top-shelf-row {
                flex-wrap: wrap;
            }

            .bottom-cabinet-row {
                flex-wrap: wrap;
            }

            .shelf-cabinet {
                flex: 1 1 30%;
                min-width: 280px;
            }

            .drawer-cabinet {
                flex: 1 1 30%;
                min-width: 150px;
            }

            .desktop-area-container {
                flex-direction: column;
            }

            .center-game-zone {
                flex: 1;
                min-width: 100%;
                order: -1;
            }

            .drop-zone {
                min-height: 60px;
            }
        }

        @media (max-width: 900px) {
            .drawer-cabinet {
                flex: 1 1 45%;
            }

            .shelf-cabinet {
                flex: 1 1 45%;
            }
        }

        @media (max-width: 768px) {
            .compact-header {
                font-size: 0.85rem;
            }

            .drug-slot {
                font-size: 0.5rem;
                min-height: 28px;
            }

            .shelf-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .drawer-cabinet {
                flex: 1 1 100%;
            }

            .shelf-cabinet {
                flex: 1 1 100%;
            }

            .desktop-area-container {
                padding: 8px;
                gap: 10px;
            }
        }

        /* Drug Image Styling */
        #drugImageOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            cursor: pointer;
            backdrop-filter: blur(2px);
        }

        #drugImageOverlay img {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            border: 4px solid white;
            object-fit: contain;
            transition: transform 0.2s;
        }

        #drugImageOverlay img:hover {
            transform: scale(1.02);
        }

        /* Âè≥ÊâãÂçÄËó•ÂìÅÂúñÁâáÈ°ØÁ§∫ */
        .drug-image-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            width: 100%;
            box-sizing: border-box;
        }

        .drug-image-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: #e74c3c;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .drug-image-close:hover {
            background: #c0392b;
        }

        .drug-image-preview {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #ddd;
            margin-bottom: 8px;
        }

        .drug-image-name {
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <!-- ÈñãÂßãÁï´Èù¢ -->
    <div class="start-screen" id="startScreen">
        <h1>üíä Ë™øÂäëË®ìÁ∑¥ÈÅäÊà≤</h1>
        <p>Âè∞Â§ßÈÜ´Èô¢Ëó•ÂäëÈÉ® ÈñÄË®∫ÈÖçËó•Á∑¥Áøí</p>
        <button class="start-btn" onclick="startGame()">ÈñãÂßãË®ìÁ∑¥</button>
    </div>

    <!-- Result Screen -->
    <div class="result-screen" id="resultScreen">
        <div class="result-card">
            <h2>üéâ Ë®ìÁ∑¥ÂÆåÊàêÔºÅ</h2>
            <div class="result-stats">
                <p>Á∏ΩÂàÜÔºö<span class="highlight" id="finalScore">0</span> ÂàÜ</p>
                <p>Ê≠£Á¢∫ÁéáÔºö<span class="highlight" id="finalAccuracy">0</span>%</p>
                <p>ÊúÄÈ´òÈÄ£ÊìäÔºö<span class="highlight" id="finalCombo">0</span></p>
                <p id="errorDrugs"></p>
            </div>
            <button class="retry-btn" onclick="restartGame()">ÂÜçÁé©‰∏ÄÊ¨°</button>
        </div>
    </div>

    <!-- Drug Image Overlay -->
    <div id="drugImageOverlay" onclick="toggleDrugImage()">
        <img id="overlayImage" src="" alt="Drug Preview">
    </div>

    <!-- ‰∏ªÈÅäÊà≤ÂçÄ -->
    <div class="container">
        <div class="cabinet-area">
            <!-- ‰∏äÊéíÔºöC - B - A ÈñãÊîæÂºèÊû∂Â≠ê -->
            <!-- ‰∏äÊéíÔºöC - B - A ÈñãÊîæÂºèÊû∂Â≠ê -->
            <div class="top-shelf-row">
                <div class="shelf-cabinet" id="cabinetC"></div>
                <div class="shelf-cabinet" id="cabinetB"></div>
                <div class="shelf-cabinet" id="cabinetA"></div>
            </div>

            <!-- Ê°åÈù¢Â∑•‰ΩúÂçÄ - Êï¥ÂêàÁãÄÊÖãËàáÈ°åÁõÆ -->
            <div class="desktop-area-container">
                <div class="drop-zone left-hand-zone" id="leftHandZone">
                    <div class="drop-zone-label">üñ•Ô∏è Ê°åÈù¢ÂìÅÈ†Ö</div>
                    <!-- Drug Image Removed from here -->
                    <div class="drop-zone-content" id="leftHandContent"></div>
                </div>

                <!-- ‰∏≠ÈñìÔºöÈÅäÊà≤ÁãÄÊÖãËàáÈ°åÁõÆÂçÄ -->
                <div class="center-game-zone">
                    <div class="compact-header">
                        üíä Âè∞Â§ßËó•ÂäëÈÉ® Ë™øÂäëË®ìÁ∑¥ <span class="version-tag">2025/12/17</span>
                    </div>
                    <div class="compact-stats">
                        <div class="mini-stat"><span class="stat-label">‚è±</span><span class="stat-val time"
                                id="timer">60</span></div>
                        <div class="mini-stat"><span class="stat-label">üéØ</span><span class="stat-val score"
                                id="score">0</span></div>
                        <div class="mini-stat"><span class="stat-label">üî•</span><span class="stat-val combo"
                                id="combo">0</span></div>
                        <div class="mini-stat"><span class="stat-label">üìù</span><span class="stat-val"
                                id="questionCount">0/10</span></div>
                    </div>
                    <div class="mode-selector-compact">
                        <button class="mode-btn-sm location active" onclick="setMode('location')">üó∫Ô∏è ÂÆö‰Ωç</button>
                        <button class="mode-btn-sm dispensing" onclick="setMode('dispensing')">üíä ÈÖçËó•</button>
                        <button class="mode-btn-sm rush" onclick="setMode('rush')">‚ö° Ê∏¨Ë©¶</button>
                        <span class="mode-divider">|</span>
                        <button class="game-ctrl-btn pause" id="pauseBtn" onclick="togglePause()" style="display:none;">‚è∏Ô∏è Êö´ÂÅú</button>
                        <button class="game-ctrl-btn restart" id="restartBtn" onclick="restartGame()" style="display:none;">üîÑ Èáç‰æÜ</button>
                    </div>
                    <div class="hint-controls">
                        <button class="hint-toggle" id="hintToggle" onclick="toggleHintMode()">
                            <span id="hintToggleIcon">üí°</span>
                            <span id="hintToggleText">ÊèêÁ§∫Ê®°ÂºèÔºöÈóúÈñâ</span>
                        </button>
                        <button class="show-hint-btn" id="showHintBtn" onclick="showLocationHint()" disabled>
                            üéØ È°ØÁ§∫‰ΩçÁΩÆÊèêÁ§∫
                        </button>
                    </div>
                    <div class="prescription-compact">
                        <!-- ÂÆö‰ΩçÊ®°ÂºèÔºöÂñÆË°åÈ°ØÁ§∫ -->
                        <div class="location-mode-row" id="locationModeRow">
                            <div class="drug-name-compact" id="drugNameLocation">Á≠âÂæÖÈñãÂßã...</div>
                            <span class="drug-hint-compact" id="drugHintLocation"></span>
                        </div>
                        <!-- ÈÖçËó•Ê®°ÂºèÔºöÊ∞¥Âπ≥ÊéíÂàóÊâÄÊúâÂÖÉÁ¥† -->
                        <div class="dispensing-mode-row" id="dispensingModeRow" style="display: none;">
                            <div class="drug-name-compact" id="drugNameDispensing">Á≠âÂæÖÈñãÂßã...</div>
                            <span class="quantity-badge" id="drugQuantityBadge">√ó0</span>
                            <span class="spec-badge" id="specBadge">10/Áõí</span>
                            <div class="counter-group">
                                <div class="counter-item">
                                    <button class="counter-minus" onclick="adjustCount('box', -1)">‚àí</button>
                                    <div class="counter-circle" onclick="adjustCount('box', 1)" id="boxCount">0</div>
                                    <span class="counter-label">Áõí</span>
                                </div>
                                <div class="counter-item">
                                    <button class="counter-minus" onclick="adjustCount('strip', -1)">‚àí</button>
                                    <div class="counter-circle" onclick="adjustCount('strip', 1)" id="stripCount">0
                                    </div>
                                    <span class="counter-label">Êéí</span>
                                </div>
                                <div class="counter-item">
                                    <button class="counter-minus" onclick="adjustCount('loose', -1)">‚àí</button>
                                    <div class="counter-circle" onclick="adjustCount('loose', 1)" id="looseCount">0
                                    </div>
                                    <span class="counter-label">È°Ü</span>
                                </div>
                            </div>
                            <button class="submit-btn-sm" onclick="submitDispensing()">‚úì</button>
                        </div>
                        <div class="inline-hint" id="inlineHint" aria-live="polite"></div>
                    </div>
                    <div class="desktop-drug-pool" id="desktopDrugPool" aria-label="Ê°åÈù¢ÂçÄÂ∏∏ÂÇôËó•">
                        <span class="desktop-drug-pool-label">Ê°åÈù¢ÂçÄÔºö</span>
                        <div class="desktop-drug-pool-items" id="desktopDrugPoolItems"></div>
                    </div>
                </div>

                <div class="drop-zone right-hand-zone" id="rightHandZone">
                    <div class="drop-zone-label">‚úã Âè≥ÊâãÂçÄ</div>
                    <div class="drop-zone-content" id="rightHandContent"></div>
                </div>
            </div>

            <!-- ‰∏ãÊéíÔºöJ - I - H - G - F - E ÊäΩÂ±úÊ´É -->
            <!-- ‰∏ãÊéíÔºöJ - I - H - G - F - E ÊäΩÂ±úÊ´É -->
            <div class="bottom-cabinet-row">
                <div class="drawer-cabinet" id="cabinetJ"></div>
                <div class="drawer-cabinet" id="cabinetI"></div>
                <div class="drawer-cabinet" id="cabinetH"></div>
                <div class="drawer-cabinet" id="cabinetG"></div>
                <div class="drawer-cabinet" id="cabinetF"></div>
                <div class="drawer-cabinet" id="cabinetE"></div>
            </div>
        </div>
    </div>

    <div class="feedback" id="feedback"></div>

    <!-- ÊîæÂ§ßË¶ñÁ™óÊ®°ÊÖã -->
    <div class="zoom-modal" id="zoomModal">
        <div class="zoom-content">
            <div class="zoom-header">
                <div class="zoom-title" id="zoomTitle"></div>
                <button class="zoom-close" onclick="closeZoomModal()">‚úï</button>
            </div>
            <div class="zoom-grid" id="zoomGrid"></div>
        </div>
    </div>

    <script src="drug_map.js"></script>

    <script>
        // ==================== Ëó•ÂìÅË≥áÊñôÂ∫´ (Ê†πÊìöÂØ¶Èöõ‰ΩçÁΩÆÂúñ 20251217) ====================
        const drugDatabase = [
            // ========== C Ê´É (‰∏äÊéíÂ∑¶ÂÅ¥Êû∂Â≠êÔºå5Â±§√ó6Ê†º) ==========
            { name: "Lixiana 30mg", cabinet: "C", row: 1, col: 1, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Pradaxa 110mg", cabinet: "C", row: 1, col: 2, stripSize: 10, boxSize: 60 },
            { name: "Zanidip", cabinet: "C", row: 1, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Plavix", cabinet: "C", row: 1, col: 4, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "DOXABEN XL 4MG", cabinet: "C", row: 1, col: 5, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Edarbi", cabinet: "C", row: 1, col: 6, isBox: true, stripSize: 14, boxSize: 28 },

            { name: "Ateol", cabinet: "C", row: 2, col: 1, stripSize: 14, boxSize: 100 },
            { name: "Nifedipine 30mg", cabinet: "C", row: 2, col: 2, stripSize: 14, boxSize: 100 },
            { name: "COZAAR", cabinet: "C", row: 2, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Bokey", cabinet: "C", row: 2, col: 4, stripSize: 28, boxSize: 100 },
            { name: "Diovan", cabinet: "C", row: 2, col: 5, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Acetal", cabinet: "C", row: 2, col: 6, stripSize: 10, boxSize: 100 },

            { name: "Arheuma", cabinet: "C", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "EURICON 50mg", cabinet: "C", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Forflow SR", cabinet: "C", row: 3, col: 3, stripSize: 10, boxSize: 30 },
            { name: "Aldactone", cabinet: "C", row: 3, col: 4, stripSize: 10, boxSize: 100 },
            { name: "DILATREND 6.25mg", cabinet: "C", row: 3, col: 5, stripSize: 10, boxSize: 30 },
            { name: "MgO 56#", cabinet: "C", row: 3, col: 6, stripSize: 10, boxSize: 56 },

            { name: "Dexilant", cabinet: "C", row: 4, col: 1, isBox: true, stripSize: 7, boxSize: 14 },
            { name: "Urief", cabinet: "C", row: 4, col: 2, stripSize: 14, boxSize: 100 },
            { name: "Dulcolax", cabinet: "C", row: 4, col: 3, stripSize: 20, boxSize: 100 },
            { name: "Livalo", cabinet: "C", row: 4, col: 4, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Diamicron", cabinet: "C", row: 4, col: 5, stripSize: 30, boxSize: 100 },
            { name: "Fluitran", cabinet: "C", row: 4, col: 6, stripSize: 10, boxSize: 100 },

            { name: "Norvasc", cabinet: "C", row: 5, col: 1, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Certican", cabinet: "C", row: 5, col: 2, stripSize: 10, boxSize: 60 },
            { name: "Lipitor", cabinet: "C", row: 5, col: 3, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Amaryl", cabinet: "C", row: 5, col: 4, stripSize: 15, boxSize: 100 },
            { name: "Betmiga", cabinet: "C", row: 5, col: 5, isBox: true, stripSize: 7, boxSize: 28 },

            // ========== B Ê´É (‰∏äÊéí‰∏≠ÈñìÊû∂Â≠êÔºå5Â±§√ó6Ê†º) ==========
            { name: "Celebrex", cabinet: "B", row: 1, col: 1, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Nebilet", cabinet: "B", row: 1, col: 2, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Crestor", cabinet: "B", row: 1, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Requip PD 2mg", cabinet: "B", row: 1, col: 4, isBox: true, stripSize: 4, boxSize: 28 },
            { name: "Entresto 50mg", cabinet: "B", row: 1, col: 5, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Lasix", cabinet: "B", row: 1, col: 6, stripSize: 15, boxSize: 100 },

            { name: "Exforge", cabinet: "B", row: 2, col: 1, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Aprovel 300mg", cabinet: "B", row: 2, col: 2, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Youkoxia", cabinet: "B", row: 2, col: 3, stripSize: 7, boxSize: 100 },

            { name: "Trajenta", cabinet: "B", row: 3, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Strocain", cabinet: "B", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Musco", cabinet: "B", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Kascoal", cabinet: "B", row: 3, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Weimok", cabinet: "B", row: 3, col: 5, stripSize: 10, boxSize: 100 },

            { name: "Biofermin", cabinet: "B", row: 4, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Trileptal", cabinet: "B", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Januvia", cabinet: "B", row: 4, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Promeran", cabinet: "B", row: 4, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Synorid", cabinet: "B", row: 4, col: 5, stripSize: 10, boxSize: 100 },
            { name: "Regrow SR", cabinet: "B", row: 4, col: 6, stripSize: 10, boxSize: 30 },

            { name: "MgO 28#", cabinet: "B", row: 5, col: 1, stripSize: 10, boxSize: 28 },
            { name: "Êñ∞ Pronolol", cabinet: "B", row: 5, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Vit. B C 28#", cabinet: "B", row: 5, col: 3, stripSize: 10, boxSize: 28 },
            { name: "Traceton", cabinet: "B", row: 5, col: 4, stripSize: 21, boxSize: 100 },
            { name: "Oxbu", cabinet: "B", row: 5, col: 5, stripSize: 14, boxSize: 100 },

            // ========== A Ê´É (‰∏äÊéíÂè≥ÂÅ¥Êû∂Â≠êÔºå6Â±§√ó6Ê†º) ==========
            { name: "Curam", cabinet: "A", row: 1, col: 1, isBox: true, stripSize: 2, boxSize: 14 },
            { name: "Amanda", cabinet: "A", row: 1, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Feburic", cabinet: "A", row: 1, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Forxiga", cabinet: "A", row: 1, col: 4, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Pariet", cabinet: "A", row: 1, col: 5, isBox: true, stripSize: 7, boxSize: 14 },
            { name: "Juxac", cabinet: "A", row: 1, col: 6, stripSize: 7, boxSize: 100 },

            { name: "Glucophage", cabinet: "A", row: 2, col: 1, stripSize: 14, boxSize: 70 },
            { name: "Olmetec", cabinet: "A", row: 2, col: 2, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Ferrum", cabinet: "A", row: 2, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Singulair 10mg", cabinet: "A", row: 2, col: 4, isBox: true, stripSize: 7, boxSize: 28 },
            { name: "Algitab", cabinet: "A", row: 2, col: 5, stripSize: 12, boxSize: 84 },
            // A2 col 6: Mevalotin Â∑≤ÁßªÈô§

            { name: "SOLAXIN", cabinet: "A", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Jardiance", cabinet: "A", row: 3, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Diphenidol", cabinet: "A", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Zoloft", cabinet: "A", row: 3, col: 4, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Amoxicillin", cabinet: "A", row: 3, col: 5, stripSize: 10, boxSize: 100 },
            { name: "Effexor 75", cabinet: "A", row: 3, col: 6, isBox: true, stripSize: 14, boxSize: 28 },

            { name: "Creon", cabinet: "A", row: 4, col: 1, isBox: true, stripSize: 10, boxSize: 100 },
            { name: "Predonine", cabinet: "A", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Xyzal", cabinet: "A", row: 4, col: 3, stripSize: 10, boxSize: 30 },
            { name: "Naposin", cabinet: "A", row: 4, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Glucobay", cabinet: "A", row: 4, col: 5, stripSize: 10, boxSize: 100 },
            { name: "Lescol XL", cabinet: "A", row: 4, col: 6, isBox: true, stripSize: 7, boxSize: 28 },

            { name: "Nexium", cabinet: "A", row: 5, col: 1, stripSize: 7, boxSize: 28 },
            { name: "Lipanthyl", cabinet: "A", row: 5, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Baraclude 0.5mg", cabinet: "A", row: 5, col: 3, stripSize: 10, boxSize: 30 },
            { name: "CellCept", cabinet: "A", row: 5, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Prograf 1mg", cabinet: "A", row: 5, col: 5, isBox: true, stripSize: 10, boxSize: 50 },
            { name: "Zyprexa", cabinet: "A", row: 5, col: 6, isBox: true, stripSize: 7, boxSize: 28 },

            { name: "Natrilix", cabinet: "A", row: 6, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Qtern", cabinet: "A", row: 6, col: 2, stripSize: 14, boxSize: 28 },
            { name: "Lyrica", cabinet: "A", row: 6, col: 3, isBox: true, stripSize: 14, boxSize: 56 },
            { name: "Nacid", cabinet: "A", row: 6, col: 6, stripSize: 10, boxSize: 100 },

            // ========== J Ê´É (‰∏ãÊéíÊúÄÂ∑¶ÔºåÂÉÖÊäΩÂ±ú) ==========
            // ========== J Ê´É ==========
            // J1 ÊäΩÂ±ú (Ê†πÊìö PDF 20260129 Áâà) - 3ÂàóÂ∏ÉÂ±Ä
            { name: "Myfortic", cabinet: "J", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 120 },
            { name: "Sulpin 200mg", cabinet: "J", section: "drawer1", row: 1, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Akinfree", cabinet: "J", section: "drawer1", row: 1, col: 3, stripSize: 10, boxSize: 30 },
            { name: "ESTRADE", cabinet: "J", section: "drawer1", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Wecoli", cabinet: "J", section: "drawer1", row: 2, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Catapress", cabinet: "J", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "PLAQUENIL", cabinet: "J", section: "drawer1", row: 3, col: 2, stripSize: 15, boxSize: 60 },
            { name: "Colian", cabinet: "J", section: "drawer1", row: 4, col: 1, stripSize: 10, boxSize: 100 },
            // J2 ÊäΩÂ±ú
            { name: "Vimpat", cabinet: "J", section: "drawer2", row: 1, col: 1, stripSize: 14, boxSize: 56 },
            { name: "Fycompa", cabinet: "J", section: "drawer2", row: 1, col: 2, stripSize: 14, boxSize: 100 },
            { name: "Catilon", cabinet: "J", section: "drawer2", row: 1, col: 3, stripSize: 21, boxSize: 100 },
            { name: "Calcium Carbonate", cabinet: "J", section: "drawer2", row: 1, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Advagraf 1mg", cabinet: "J", section: "drawer2", row: 2, col: 1, stripSize: 10, boxSize: 50 },
            { name: "Splotin 50mg", cabinet: "J", section: "drawer2", row: 2, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Pletaal", cabinet: "J", section: "drawer2", row: 2, col: 3, stripSize: 10, boxSize: 50 },
            { name: "U-Ca", cabinet: "J", section: "drawer2", row: 2, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Cinnazine", cabinet: "J", section: "drawer2", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Takepron", cabinet: "J", section: "drawer2", row: 3, col: 2, stripSize: 14, boxSize: 28 },
            { name: "Mopride", cabinet: "J", section: "drawer2", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Midorine", cabinet: "J", section: "drawer2", row: 3, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Doxymycin", cabinet: "J", section: "drawer2", row: 4, col: 1, stripSize: 10, boxSize: 100 },

            // ========== I Ê´É ==========
            // I1 ÊäΩÂ±ú (3ÂàóÂ∏ÉÂ±Ä)
            { name: "Azilect", cabinet: "I", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Doxaben 2mg", cabinet: "I", section: "drawer1", row: 1, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Denosin", cabinet: "I", section: "drawer1", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Suzin", cabinet: "I", section: "drawer1", row: 2, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Sigmart", cabinet: "I", section: "drawer1", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Concor 5", cabinet: "I", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Sandel", cabinet: "I", section: "drawer1", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Herbesser", cabinet: "I", section: "drawer1", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Colchicine", cabinet: "I", section: "drawer1", row: 4, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Allegra", cabinet: "I", section: "drawer1", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Imovane", cabinet: "I", section: "drawer1", row: 4, col: 3, stripSize: 10, boxSize: 20 },
            // I2 ÊäΩÂ±ú
            { name: "Avodart", cabinet: "I", section: "drawer2", row: 1, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Rytmonorm", cabinet: "I", section: "drawer2", row: 1, col: 2, stripSize: 10, boxSize: 60 },
            { name: "Meletin", cabinet: "I", section: "drawer2", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Glunormal", cabinet: "I", section: "drawer2", row: 1, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Femara", cabinet: "I", section: "drawer2", row: 2, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Aspirin", cabinet: "I", section: "drawer2", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Tofranil 25mg", cabinet: "I", section: "drawer2", row: 2, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Acemet", cabinet: "I", section: "drawer2", row: 2, col: 4, stripSize: 10, boxSize: 100 },
            { name: "Xarelto 10mg", cabinet: "I", section: "drawer2", row: 3, col: 1, stripSize: 14, boxSize: 28 },
            { name: "Alfacalcidol", cabinet: "I", section: "drawer2", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Mobicam", cabinet: "I", section: "drawer2", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Actos", cabinet: "I", section: "drawer2", row: 3, col: 4, stripSize: 10, boxSize: 30 },
            { name: "Repaglinide", cabinet: "I", section: "drawer2", row: 3, col: 5, stripSize: 10, boxSize: 100 },

            // ========== H Ê´É ==========
            // H1 ÊäΩÂ±ú (3ÂàóÂ∏ÉÂ±Ä)
            { name: "Cofarin 1mg", cabinet: "H", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Antiasth", cabinet: "H", section: "drawer1", row: 1, col: 2, stripSize: 6, boxSize: 100 },
            { name: "Eliquis", cabinet: "H", section: "drawer1", row: 1, col: 3, stripSize: 14, boxSize: 60 },
            { name: "Baktar", cabinet: "H", section: "drawer1", row: 2, col: 1, stripSize: 10, boxSize: 20 },
            { name: "Meptin", cabinet: "H", section: "drawer1", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Lendormin", cabinet: "H", section: "drawer1", row: 2, col: 3, stripSize: 10, boxSize: 20 },
            { name: "Cephalexin", cabinet: "H", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Cordarone", cabinet: "H", section: "drawer1", row: 3, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Userm", cabinet: "H", section: "drawer1", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Eurodin", cabinet: "G", section: "drawer1", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            // H2 ÊäΩÂ±ú
            { name: "Aleviatin", cabinet: "H", section: "drawer2", row: 1, col: 1, stripSize: 21, boxSize: 100 },
            { name: "Glyxambi", cabinet: "H", section: "drawer2", row: 1, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Epram", cabinet: "H", section: "drawer2", row: 1, col: 3, stripSize: 10, boxSize: 28 },
            { name: "Cymbalta", cabinet: "H", section: "drawer2", row: 1, col: 4, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Sirdalud", cabinet: "H", section: "drawer2", row: 2, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Mesyrel", cabinet: "H", section: "drawer2", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Valdoxan", cabinet: "H", section: "drawer2", row: 2, col: 3, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Seroquel 25mg", cabinet: "H", section: "drawer2", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Abilify", cabinet: "H", section: "drawer2", row: 3, col: 3, stripSize: 10, boxSize: 30 },
            { name: "Apa-Mirtazapine ODT", cabinet: "H", section: "drawer2", row: 3, col: 4, stripSize: 10, boxSize: 30 },
            { name: "Tofranil 10mg", cabinet: "H", section: "drawer2", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Clozaril", cabinet: "H", section: "drawer2", row: 4, col: 3, stripSize: 10, boxSize: 100 },

            // ========== G Ê´É ==========
            // G1 ÊäΩÂ±ú (3ÂàóÂ∏ÉÂ±Ä)
            { name: "Secorin", cabinet: "G", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Lexotan", cabinet: "G", section: "drawer1", row: 1, col: 2, stripSize: 10, boxSize: 50 },
            { name: "Utraphen", cabinet: "G", section: "drawer1", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Rivotril", cabinet: "G", section: "drawer1", row: 2, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Stilnox", cabinet: "G", section: "drawer1", row: 2, col: 2, stripSize: 14, boxSize: 20 },
            { name: "Ativan", cabinet: "G", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Alpraline", cabinet: "G", section: "drawer1", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            // G2 ÊäΩÂ±ú
            { name: "Mirapex 1mg", cabinet: "G", section: "drawer2", row: 1, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Advagraf 1mg (G)", cabinet: "G", section: "drawer2", row: 1, col: 2, stripSize: 10, boxSize: 50 },

            // ========== F Ê´É ==========
            // F1 ÊäΩÂ±ú
            { name: "Seroquel XR 200mg", cabinet: "F", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 60 },
            { name: "Isoptin SR", cabinet: "F", section: "drawer1", row: 1, col: 2, stripSize: 15, boxSize: 100 },
            { name: "Syntam", cabinet: "F", section: "drawer1", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Dosin", cabinet: "F", section: "drawer1", row: 2, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Nolvadex", cabinet: "F", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 30 },
            { name: "Keppra", cabinet: "F", section: "drawer1", row: 3, col: 2, stripSize: 10, boxSize: 60 },
            { name: "Methylcobal", cabinet: "F", section: "drawer1", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Uroso", cabinet: "F", section: "drawer1", row: 4, col: 2, stripSize: 10, boxSize: 100 },
            // F2 ÊäΩÂ±ú
            { name: "Procal", cabinet: "F", section: "drawer2", row: 1, col: 1, stripSize: 10, boxSize: 100 },
            { name: "LAMICTAL", cabinet: "F", section: "drawer2", row: 1, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Depakine", cabinet: "F", section: "drawer2", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Sinemet 100#", cabinet: "F", section: "drawer2", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Salazine 28#", cabinet: "F", section: "drawer2", row: 3, col: 1, stripSize: 10, boxSize: 28 },
            { name: "Madopar 21#", cabinet: "F", section: "drawer2", row: 4, col: 2, stripSize: 21, boxSize: 100 },
            // F3 Â∑¶ÈñÄ (ÂîØ‰∏Ä‰øùÁïôÁöÑÈñÄ)
            { name: "Pacrea", cabinet: "F", section: "doorL", row: 1, col: 1, isBox: true, stripSize: 10, boxSize: 100 },

            // ========== E Ê´É ==========
            // E1 ÊäΩÂ±ú
            { name: "Neuquinon", cabinet: "E", section: "drawer1", row: 1, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Atanaal 5mg", cabinet: "E", section: "drawer1", row: 1, col: 2, stripSize: 10, boxSize: 30 },
            { name: "Sandimmun 25", cabinet: "E", section: "drawer1", row: 1, col: 3, stripSize: 5, boxSize: 50 },
            { name: "Nitrostat Sub.", cabinet: "E", section: "drawer1", row: 2, col: 1, stripSize: 10, boxSize: 25 },
            { name: "Folina", cabinet: "E", section: "drawer1", row: 2, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Stable 25", cabinet: "E", section: "drawer1", row: 2, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Ginkgocentrate", cabinet: "E", section: "drawer1", row: 3, col: 1, stripSize: 10, boxSize: 100 },
            { name: "Votan", cabinet: "E", section: "drawer1", row: 3, col: 2, stripSize: 10, boxSize: 100 },
            { name: "Imolex", cabinet: "E", section: "drawer1", row: 3, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Visanne", cabinet: "E", section: "drawer1", row: 4, col: 2, isBox: true, stripSize: 14, boxSize: 28 },
            { name: "Utrogestan", cabinet: "E", section: "drawer1", row: 4, col: 3, stripSize: 15, boxSize: 100 },
            // E2 ÊäΩÂ±ú
            { name: "Foxone oph.", cabinet: "E", section: "drawer2", row: 1, col: 1, stripSize: 1, boxSize: 1 },
            { name: "O.N.S.D.", cabinet: "E", section: "drawer2", row: 1, col: 2, stripSize: 1, boxSize: 1 },
            { name: "Comtan 30#", cabinet: "E", section: "drawer2", row: 1, col: 3, stripSize: 30, boxSize: 100 },
            { name: "Artelac oph.", cabinet: "E", section: "drawer2", row: 2, col: 1, stripSize: 1, boxSize: 1 },
            { name: "Methacin gel", cabinet: "E", section: "drawer2", row: 2, col: 2, stripSize: 1, boxSize: 1 },
            { name: "Nincort", cabinet: "E", section: "drawer2", row: 2, col: 3, stripSize: 1, boxSize: 1 },
            { name: "Rinderon-V", cabinet: "E", section: "drawer2", row: 3, col: 1, stripSize: 1, boxSize: 1 },
            { name: "Sinomin oph.", cabinet: "E", section: "drawer2", row: 4, col: 1, stripSize: 1, boxSize: 1 },
            { name: "Tetracycline oph", cabinet: "E", section: "drawer2", row: 4, col: 2, stripSize: 1, boxSize: 1 },
            { name: "C.B. Strong", cabinet: "E", section: "drawer2", row: 4, col: 3, stripSize: 10, boxSize: 100 },

            // ========== Ê°åÈù¢ÂçÄ ==========
            { name: "Biocal", cabinet: "Desktop", row: 1, col: 1, stripSize: 7, boxSize: 28 },
            { name: "Coxine", cabinet: "Desktop", row: 1, col: 2, stripSize: 14, boxSize: 100 },
            { name: "Sennapur", cabinet: "Desktop", row: 1, col: 3, stripSize: 10, boxSize: 100 },
            { name: "Loditon", cabinet: "Desktop", row: 1, col: 4, stripSize: 10, boxSize: 100 },
            { name: "HARNALIDGE", cabinet: "Desktop", row: 1, col: 5, stripSize: 14, boxSize: 100 },
        ];

        // ==================== ÈÅäÊà≤ÁãÄÊÖã ====================
        let gameState = {
            mode: 'location',
            score: 0,
            combo: 0,
            maxCombo: 0,
            timeLeft: 60,
            questionCount: 0,
            totalQuestions: 10,
            currentDrug: null,
            currentQuantity: 0,
            positionConfirmed: false,
            correctCount: 0,
            wrongCount: 0,
            wrongDrugs: [],
            timerInterval: null,
            isPlaying: false,
            hintMode: false, // ÊèêÁ§∫Ê®°ÂºèÈñãÈóú
            timerStarted: false, // Ë®àÊôÇÂô®ÊòØÂê¶Â∑≤ÂïüÂãï
            isPaused: false, // ÈÅäÊà≤ÊòØÂê¶Êö´ÂÅú
        };
        let inlineHintTimeout = null;

        // ==================== ÂàùÂßãÂåñ ====================
        function init() {
            generateCabinets();
        }

        // ==================== ÊîæÂ§ßË¶ñÁ™óÂäüËÉΩ ====================
        function openCabinetZoom(cabinet, type) {
            const modal = document.getElementById('zoomModal');
            const title = document.getElementById('zoomTitle');
            const grid = document.getElementById('zoomGrid');

            title.textContent = `${cabinet} Ê´ÉË©≥Á¥∞Ê™¢Ë¶ñ`;

            if (type === 'shelf') {
                // ‰∏äÊéíÊû∂Â≠êÊîæÂ§ß
                const rows = cabinet === 'A' ? 6 : 5;
                grid.className = 'zoom-grid shelf-layout';
                grid.innerHTML = '';

                for (let r = 1; r <= rows; r++) {
                    for (let c = 1; c <= 6; c++) {
                        const drug = drugDatabase.find(d =>
                            d.cabinet === cabinet && d.row === r && d.col === c && !d.section
                        );
                        grid.appendChild(createZoomDrugCard(drug, cabinet, r, c));
                    }
                }
            } else {
                // ‰∏ãÊéíÊ´ÉÂ≠êÊîæÂ§ßÔºà2x2Á∂≤Ê†ºÂ∏ÉÂ±ÄÔºâ
                grid.className = '';
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = '1fr 1fr';
                grid.style.gap = '15px';
                grid.innerHTML = '';

                // ËºîÂä©ÂáΩÊï∏ÔºöÂèñÂæóÊåáÂÆöÂçÄÂüüÁöÑÊâÄÊúâËó•ÂìÅ‰∏¶‰ª•Á∂≤Ê†ºÈ°ØÁ§∫
                function getDrawerGridHTML(cab, section, title) {
                    const drugs = drugDatabase.filter(d => d.cabinet === cab && d.section === section);
                    if (drugs.length === 0) {
                        return `<div><h3 class="zoom-section-title">${title}</h3><div class="zoom-grid drawer-layout"><div class="zoom-drug-card empty"><div class="zoom-drug-name">Á©∫</div></div></div></div>`;
                    }

                    // ÊâæÂá∫ÊúÄÂ§ßË°åÂàóÊï∏
                    const maxRow = Math.max(...drugs.map(d => d.row || 1));
                    const maxCol = Math.max(...drugs.map(d => d.col || 1));

                    let html = `<div><h3 class="zoom-section-title">${title}</h3><div class="zoom-grid" style="grid-template-columns: repeat(${Math.min(maxCol, 4)}, 1fr);">`;

                    for (let r = 1; r <= maxRow; r++) {
                        for (let c = 1; c <= Math.min(maxCol, 4); c++) {
                            const drug = drugs.find(d => (d.row || 1) === r && d.col === c);
                            html += createZoomDrugCard(drug, cab, r, c, section).outerHTML;
                        }
                    }
                    html += '</div></div>';
                    return html;
                }

                // ÊäΩÂ±ú 1ÔºàÂ∑¶‰∏äÔºâ
                let drawer1HTML = getDrawerGridHTML(cabinet, 'drawer1', 'ÊäΩÂ±ú 1');

                // ÊäΩÂ±ú 2ÔºàÂè≥‰∏äÔºâ
                let drawer2HTML = getDrawerGridHTML(cabinet, 'drawer2', 'ÊäΩÂ±ú 2');

                // Â∑¶ÈñÄÔºàÂ∑¶‰∏ãÔºâ- Âè™Êúâ F Ê´ÉÊúâ Pacrea
                let doorLHTML = getDrawerGridHTML(cabinet, 'doorL', 'Â∑¶ÈñÄ');

                // Âè≥ÈñÄÔºàÂè≥‰∏ãÔºâ
                let doorRHTML = getDrawerGridHTML(cabinet, 'doorR', 'Âè≥ÈñÄ');

                grid.innerHTML = drawer1HTML + drawer2HTML + doorLHTML + doorRHTML;
            }

            modal.classList.add('active');
        }

        function openDrawerZoom(cabinet, section) {
            const modal = document.getElementById('zoomModal');
            const title = document.getElementById('zoomTitle');
            const grid = document.getElementById('zoomGrid');

            const sectionNames = {
                'drawer1': 'ÊäΩÂ±ú 1',
                'drawer2': 'ÊäΩÂ±ú 2',
                'doorL': 'Â∑¶ÈñÄ',
                'doorR': 'Âè≥ÈñÄ'
            };

            title.textContent = `${cabinet} Ê´É - ${sectionNames[section]}Ë©≥Á¥∞Ê™¢Ë¶ñ`;

            // ÂãïÊÖãÂèñÂæóË©≤ÂçÄÂüüÁöÑÊâÄÊúâËó•ÂìÅ
            const drugs = drugDatabase.filter(d => d.cabinet === cabinet && d.section === section);

            if (drugs.length === 0) {
                grid.className = 'zoom-grid drawer-layout';
                grid.innerHTML = '<div class="zoom-drug-card empty"><div class="zoom-drug-name">Á©∫</div></div>';
                modal.classList.add('active');
                return;
            }

            // ÊâæÂá∫ÊúÄÂ§ßË°åÂàóÊï∏
            const maxRow = Math.max(...drugs.map(d => d.row || 1));
            const maxCol = Math.max(...drugs.map(d => d.col || 1));

            grid.className = 'zoom-grid';
            grid.style.gridTemplateColumns = `repeat(${Math.min(maxCol, 4)}, 1fr)`;
            grid.innerHTML = '';

            for (let r = 1; r <= maxRow; r++) {
                for (let c = 1; c <= Math.min(maxCol, 4); c++) {
                    const drug = drugs.find(d => (d.row || 1) === r && d.col === c);
                    grid.appendChild(createZoomDrugCard(drug, cabinet, r, c, section));
                }
            }

            modal.classList.add('active');
        }

        function createZoomDrugCard(drug, cabinet, row, col, section) {
            const card = document.createElement('div');

            if (!drug) {
                card.className = 'zoom-drug-card empty';
                card.innerHTML = '<div class="zoom-drug-name">Á©∫Ê†º</div>';
                return card;
            }

            card.className = `zoom-drug-card ${drug.isBox ? 'box' : ''}`;

            let locationText = '';
            if (row) {
                locationText = `‰ΩçÁΩÆÔºöÁ¨¨ ${row} Ë°å Á¨¨ ${col} Âàó`;
            } else if (section) {
                locationText = `‰ΩçÁΩÆÔºöÁ¨¨ ${col} Ê†º`;
            }

            card.innerHTML = `
                <div class="zoom-drug-name">${drug.name}</div>
                <div class="zoom-drug-info">
                    ${drug.isBox ? 'ÁõíË£ù' : 'Êï£Ë£ù'}<br>
                    ‰∏ÄÊéíÔºö${drug.stripSize} È°Ü<br>
                    ‰∏ÄÁõíÔºö${drug.boxSize} È°Ü
                </div>
                <div class="zoom-drug-location">${locationText}</div>
            `;

            // ÈªûÊìäÂç°ÁâáÊôÇÈ°ØÁ§∫Ëó•ÂìÅÂúñÁâá
            card.onclick = (e) => {
                e.stopPropagation();
                closeZoomModal();
                showDrugImage(drug.name);
            };

            return card;
        }

        function closeZoomModal() {
            const modal = document.getElementById('zoomModal');
            modal.classList.remove('active');
        }

        // ÈªûÊìäÊ®°ÊÖãËÉåÊôØÈóúÈñâ
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('zoomModal');
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeZoomModal();
                }
            });
        });

        // ==================== ÊèêÁ§∫Ê®°ÂºèÂäüËÉΩ ====================
        function toggleHintMode() {
            gameState.hintMode = !gameState.hintMode;
            const toggle = document.getElementById('hintToggle');
            const icon = document.getElementById('hintToggleIcon');
            const text = document.getElementById('hintToggleText');

            if (gameState.hintMode) {
                toggle.classList.add('active');
                icon.textContent = '‚ú®';
                text.textContent = 'ÊèêÁ§∫Ê®°ÂºèÔºöÈñãÂïü';
            } else {
                toggle.classList.remove('active');
                icon.textContent = 'üí°';
                text.textContent = 'ÊèêÁ§∫Ê®°ÂºèÔºöÈóúÈñâ';
            }

            // Â¶ÇÊûúÈÅäÊà≤Ê≠£Âú®ÈÄ≤Ë°åÔºåÊõ¥Êñ∞ÊèêÁ§∫È°ØÁ§∫
            if (gameState.isPlaying && gameState.currentDrug) {
                updateHintDisplay();
            }
        }

        function updateHintDisplay() {
            const hintElement = document.getElementById('drugHintLocation');
            if (!hintElement) return;

            if (gameState.hintMode && gameState.currentDrug) {
                const drug = gameState.currentDrug;
                let hintText = `üìç ‰ΩçÊñº ${drug.cabinet} Ê´É`;

                // Logic to highlight the broad area (Continuous Hint)
                // First remove old highlights
                document.querySelectorAll('.cabinet-hint-active').forEach(el => el.classList.remove('cabinet-hint-active'));

                let targetElementId = null;
                let targetSubSelector = null;

                if (['C', 'B', 'A'].includes(drug.cabinet)) {
                    targetElementId = `cabinet${drug.cabinet}`;
                    // For shelf cabinets, highlight the whole cabinet
                    const el = document.getElementById(targetElementId);
                    if (el) el.classList.add('cabinet-hint-active');
                } else {
                    // For drawer cabinets
                    targetElementId = `cabinet${drug.cabinet}`;
                    const cabEl = document.getElementById(targetElementId);

                    if (drug.section && cabEl) {
                        // Find the specific section (drawer/door) inside
                        if (drug.section === 'drawer1') {
                            const el = cabEl.querySelector('.drawer-section:nth-of-type(1)');
                            if (el) el.classList.add('cabinet-hint-active');
                        } else if (drug.section === 'drawer2') {
                            const el = cabEl.querySelector('.drawer-section:nth-of-type(2)');
                            if (el) el.classList.add('cabinet-hint-active');
                        } else if (drug.section === 'doorL') {
                            const el = cabEl.querySelector('.door:nth-of-type(1)');
                            if (el) el.classList.add('cabinet-hint-active');
                        } else if (drug.section === 'doorR') {
                            const el = cabEl.querySelector('.door:nth-of-type(2)');
                            if (el) el.classList.add('cabinet-hint-active');
                        }
                    }
                }

                if (drug.section) {
                    const sectionNames = {
                        'drawer1': 'ÊäΩÂ±ú 1',
                        'drawer2': 'ÊäΩÂ±ú 2',
                        'doorL': 'Â∑¶ÈñÄ',
                        'doorR': 'Âè≥ÈñÄ'
                    };
                    hintText += ` - ${sectionNames[drug.section]}`;
                } else if (drug.row) {
                    hintText += ` - Á¨¨ ${drug.row} Ë°å`;
                }

                hintElement.textContent = hintText;
                hintElement.style.display = 'inline';
            } else {
                hintElement.textContent = '';
                hintElement.style.display = 'none';

                // Remove highlights
                document.querySelectorAll('.cabinet-hint-active').forEach(el => el.classList.remove('cabinet-hint-active'));
            }
        }

        function showLocationHint() {
            if (!gameState.currentDrug || !gameState.isPlaying) return;

            const drug = gameState.currentDrug;

            // ÊâæÂà∞Ê≠£Á¢∫ÁöÑËó•ÂìÅÊ†ºÂ≠ê
            let targetSlot = null;

            if (drug.cabinet === 'Desktop') {
                // Ê°åÈù¢ÂçÄËó•ÂìÅ
                const desktopItems = document.querySelectorAll('#desktopDrugPoolItems .desktop-drug-item');
                desktopItems.forEach(item => {
                    if (item.textContent.trim() === drug.name) {
                        targetSlot = item;
                    }
                });
            } else {
                // Ê´É‰ΩçËó•ÂìÅ
                const allSlots = document.querySelectorAll('.drug-slot');
                allSlots.forEach(slot => {
                    const slotCabinet = slot.dataset.cabinet;
                    const slotRow = parseInt(slot.dataset.row);
                    const slotCol = parseInt(slot.dataset.col);
                    const slotSection = slot.dataset.section;

                    let isMatch = slotCabinet === drug.cabinet;

                    if (drug.section) {
                        isMatch = isMatch && slotSection === drug.section && slotCol === drug.col;
                    } else {
                        isMatch = isMatch && slotRow === drug.row && slotCol === drug.col && !slotSection;
                    }

                    if (isMatch) {
                        targetSlot = slot;
                    }
                });
            }

            if (targetSlot) {
                // ÁßªÈô§‰πãÂâçÁöÑÈñÉÁàçÊïàÊûú
                document.querySelectorAll('.slot-blinking').forEach(el => {
                    el.classList.remove('slot-blinking');
                });

                // Ê∑ªÂä†ÈñÉÁàçÊïàÊûú
                targetSlot.classList.add('slot-blinking');

                // Êç≤ÂãïÂà∞Ë©≤ÂÖÉÁ¥†
                targetSlot.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // 3ÁßíÂæåÁßªÈô§ÈñÉÁàçÊïàÊûú
                setTimeout(() => {
                    targetSlot.classList.remove('slot-blinking');
                }, 3000);
            }
        }

        function generateCabinets() {
            // ‰∏äÊéíÊû∂Â≠êÔºöC, B (5Â±§), A (6Â±§)
            ['C', 'B', 'A'].forEach(cab => {
                const el = document.getElementById(`cabinet${cab}`);
                const rows = cab === 'A' ? 6 : 5; // AÊ´ÉÊúâ6Â±§ÔºåCÂíåBÊ´ÉÊúâ5Â±§
                el.innerHTML = `
                    <div class="cab-label">${cab} Ê´É (ÈªûÊìäÊîæÂ§ß)</div>
                    <div class="shelf-grid">${generateShelfSlots(cab, rows, 6)}</div>
                `;
                // Make entire cabinet clickable
                el.onclick = function (e) {
                    // Verify we aren't clicking a slot directly (slots have their own logic)
                    if (!e.target.classList.contains('drug-slot')) {
                        openCabinetZoom(cab, 'shelf');
                    }
                };
            });

            // ‰∏ãÊéíÊ´ÉÂ≠êÔºöJ, I, H, G, F, E (ÊäΩÂ±ú+ÈñÄ)
            ['J', 'I', 'H', 'G', 'F', 'E'].forEach(cab => {
                const el = document.getElementById(`cabinet${cab}`);
                el.innerHTML = `
                    <div class="cab-label">${cab} Ê´É</div>
                    <div class="drawer-section" onclick="openDrawerZoom('${cab}', 'drawer1'); event.stopPropagation();">
                        <div class="drawer-label">ÊäΩÂ±ú 1</div>
                        <div class="drawer-grid pointer-events-none">${generateDrawerSlots(cab, 'drawer1')}</div>
                    </div>
                    <div class="drawer-section" onclick="openDrawerZoom('${cab}', 'drawer2'); event.stopPropagation();">
                        <div class="drawer-label">ÊäΩÂ±ú 2</div>
                        <div class="drawer-grid pointer-events-none">${generateDrawerSlots(cab, 'drawer2')}</div>
                    </div>
                    <div class="door-section">
                        <div class="door" onclick="openDrawerZoom('${cab}', 'doorL'); event.stopPropagation();">
                            <div class="door-label">Â∑¶ÈñÄ</div>
                            <div class="door-grid pointer-events-none">${generateDoorSlots(cab, 'doorL')}</div>
                        </div>
                        <div class="door" onclick="openDrawerZoom('${cab}', 'doorR'); event.stopPropagation();">
                            <div class="door-label">Âè≥ÈñÄ</div>
                            <div class="door-grid pointer-events-none">${generateDoorSlots(cab, 'doorR')}</div>
                        </div>
                    </div>
                `;
            });

            // Re-enable pointer events for slots inside
            document.querySelectorAll('.drawer-grid .drug-slot, .door-grid .drug-slot').forEach(slot => {
                slot.parentElement.style.pointerEvents = 'none'; // Grid container ignores clicks
                slot.style.pointerEvents = 'auto'; // But slots inside accept them
            });

            // Ê°åÈù¢ÂçÄ - ÂàùÂßãÂåñÊãñÊãâÂäüËÉΩ
            generateDesktopDrugs();
            initDragAndDrop();
        }

        function generateShelfSlots(cabinet, rows, cols) {
            let html = '';
            for (let r = 1; r <= rows; r++) {
                for (let c = 1; c <= cols; c++) {
                    const drug = drugDatabase.find(d =>
                        d.cabinet === cabinet && d.row === r && d.col === c && !d.section
                    );
                    const name = drug ? drug.name : '';
                    const displayName = name.length > 10 ? name.substring(0, 10) + '..' : name;
                    const boxClass = drug?.isBox ? 'box' : '';
                    const draggable = name ? 'true' : 'false';
                    html += `<div class="drug-slot ${boxClass}"
                        draggable="${draggable}"
                        data-cabinet="${cabinet}"
                        data-row="${r}"
                        data-col="${c}"
                        data-drug-name="${name}"
                        onclick="selectSlot(this); event.stopPropagation();"
                        title="${name}">${displayName}</div>`;
                }
            }
            return html;
        }

        function generateDrawerSlots(cabinet, section) {
            let html = '';
            for (let c = 1; c <= 3; c++) {
                // Âè™È°ØÁ§∫Á¨¨‰∏ÄÊéíÁöÑËó•ÂìÅ‰ΩúÁÇ∫È†êË¶Ω
                const drug = drugDatabase.find(d =>
                    d.cabinet === cabinet && d.section === section && d.col === c && (d.row === 1 || !d.row)
                );
                const name = drug ? drug.name : '';
                const displayName = name.length > 8 ? name.substring(0, 8) + '..' : name;
                const boxClass = drug?.isBox ? 'box' : '';
                const draggable = name ? 'true' : 'false';
                html += `<div class="drug-slot ${boxClass}"
                    draggable="${draggable}"
                    data-cabinet="${cabinet}"
                    data-section="${section}"
                    data-col="${c}"
                    data-drug-name="${name}"
                    onclick="selectSlot(this); event.stopPropagation();"
                    title="${name}">${displayName}</div>`;
            }
            return html;
        }

        function generateDoorSlots(cabinet, section) {
            let html = '';
            for (let c = 1; c <= 2; c++) {
                const drug = drugDatabase.find(d =>
                    d.cabinet === cabinet && d.section === section && d.col === c
                );
                const name = drug ? drug.name : '';
                const displayName = name.length > 7 ? name.substring(0, 7) + '..' : name;
                const boxClass = drug?.isBox ? 'box' : '';
                const draggable = name ? 'true' : 'false';
                html += `<div class="drug-slot ${boxClass}"
                    draggable="${draggable}"
                    data-cabinet="${cabinet}"
                    data-section="${section}"
                    data-col="${c}"
                    data-drug-name="${name}"
                    onclick="selectSlot(this); event.stopPropagation();"
                    title="${name}">${displayName}</div>`;
            }
            return html;
        }

        function generateDesktopDrugs() {
            const pool = document.getElementById('desktopDrugPool');
            const container = document.getElementById('desktopDrugPoolItems');
            if (!container) return;

            container.innerHTML = '';
            const desktopDrugs = drugDatabase.filter(d => d.cabinet === 'Desktop');

            desktopDrugs.forEach(drug => {
                const item = document.createElement('div');
                item.className = 'draggable-drug';
                item.draggable = false;
                item.dataset.drugName = drug.name;
                item.textContent = drug.name;
                item.title = drug.name;
                item.onclick = function () { selectDesktopDrug(this); };
                container.appendChild(item);
            });

            if (pool) {
                pool.style.display = desktopDrugs.length ? 'flex' : 'none';
            }
        }

        function initDragAndDrop() {
            const zones = ['leftHandZone', 'rightHandZone'];

            zones.forEach(zoneId => {
                const zone = document.getElementById(zoneId);
                if (!zone) return;
                const content = zone.querySelector('.drop-zone-content');

                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', (e) => {
                    if (!zone.contains(e.relatedTarget)) {
                        zone.classList.remove('drag-over');
                    }
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');

                    const drugName = e.dataTransfer.getData('text/plain');
                    const sourceType = e.dataTransfer.getData('source-type');

                    // Ê™¢Êü•ÊòØÂê¶Â∑≤Á∂ìÂú®Â∑¶Âè≥ÊâãÂçÄÂ≠òÂú®Ê≠§Ëó•ÂìÅ
                    let existingDrug = document.querySelector(`.draggable-drug[data-drug-name="${drugName}"]`);

                    if (existingDrug) {
                        // ÁßªÂãïÂ∑≤Â≠òÂú®ÁöÑËó•ÂìÅ
                        existingDrug.classList.remove('in-left', 'in-right');
                        if (zoneId === 'leftHandZone') {
                            existingDrug.classList.add('in-left');
                        } else if (zoneId === 'rightHandZone') {
                            existingDrug.classList.add('in-right');
                        }
                        content.appendChild(existingDrug);
                    } else if (sourceType === 'cabinet' && drugName) {
                        // ÂæûËó•Ê´ÉÊãñÂÖ•ÔºöÂª∫Á´ãÊñ∞ÁöÑËó•ÂìÅÊ®ôÁ±§
                        const newDrug = document.createElement('div');
                        newDrug.className = 'draggable-drug';
                        newDrug.draggable = true;
                        newDrug.dataset.drugName = drugName;
                        newDrug.textContent = drugName;
                        newDrug.onclick = function () { selectDesktopDrug(this); };

                        if (zoneId === 'leftHandZone') {
                            newDrug.classList.add('in-left');
                        } else if (zoneId === 'rightHandZone') {
                            newDrug.classList.add('in-right');
                        }

                        content.appendChild(newDrug);
                    }
                });
            });

            // ÁÇ∫Ê°åÈù¢ÂèØÊãñÊõ≥Ëó•ÂìÅÁ∂ÅÂÆö‰∫ã‰ª∂
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('draggable-drug')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.drugName);
                    e.dataTransfer.setData('source-type', 'desktop');
                    e.dataTransfer.effectAllowed = 'move';
                }
                // Ëó•Ê´ÉÊ†ºÂ≠êÊãñÊõ≥
                else if (e.target.classList.contains('drug-slot') && e.target.dataset.drugName) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.drugName);
                    e.dataTransfer.setData('source-type', 'cabinet');
                    e.dataTransfer.effectAllowed = 'copy';
                }
            });

            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('draggable-drug') || e.target.classList.contains('drug-slot')) {
                    e.target.classList.remove('dragging');
                }
            });
        }

        function selectDesktopDrug(element) {
            if (!gameState.isPlaying || !gameState.currentDrug) return;

            const drugName = element.dataset.drugName;
            const drug = gameState.currentDrug;

            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ê≠£Á¢∫ÁöÑËó•ÂìÅ
            if (drug.cabinet === 'Desktop' && drug.name === drugName) {
                element.style.outline = '3px solid #4caf50';
                if (gameState.mode === 'location') {
                    handleCorrect();
                } else {
                    markPositionConfirmed();
                }
            } else if (drug.cabinet === 'Desktop') {
                element.style.outline = '3px solid #f44336';
                handleWrong();
                // È´ò‰∫ÆÊ≠£Á¢∫ÁöÑËó•ÂìÅ
                const correctDrug = document.querySelector(`.draggable-drug[data-drug-name="${drug.name}"]`);
                if (correctDrug) {
                    correctDrug.style.outline = '3px solid #ffc107';
                    correctDrug.style.animation = 'glow 1s infinite';
                }
            }
        }

        // ==================== ÈÅäÊà≤ÊéßÂà∂ ====================
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            resetGame();
            gameState.isPlaying = true;
            showGameControls(true);
            // Ë®àÊôÇÂô®ÊîπÁÇ∫Á¨¨‰∏ÄÊ¨°‰ΩúÁ≠îÊâçÈñãÂßãÔºå‰∏çÂú®ÈÄôË£°ÂïüÂãï
            nextQuestion();
        }

        function resetGame() {
            gameState.score = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.timeLeft = gameState.mode === 'rush' ? 180 : 120;
            gameState.questionCount = 0;
            gameState.correctCount = 0;
            gameState.wrongCount = 0;
            gameState.wrongDrugs = [];
            gameState.positionConfirmed = false;
            gameState.timerStarted = false;
            gameState.isPaused = false;
            clearInlineHint();
            updateDisplay();

            // ÈáçÁΩÆÊö´ÂÅúÊåâÈàïÁãÄÊÖã
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) {
                pauseBtn.textContent = '‚è∏Ô∏è Êö´ÂÅú';
                pauseBtn.classList.remove('paused');
            }
        }

        function restartGame() {
            document.getElementById('resultScreen').classList.remove('active');
            resetGame();
            gameState.isPlaying = true;
            showGameControls(true);
            // Ë®àÊôÇÂô®ÊîπÁÇ∫Á¨¨‰∏ÄÊ¨°‰ΩúÁ≠îÊâçÈñãÂßãÔºå‰∏çÂú®ÈÄôË£°ÂïüÂãï
            nextQuestion();
        }

        function startTimer() {
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = gameState.timeLeft;
                if (gameState.timeLeft <= 0) endGame();
            }, 1000);
        }

        function togglePause() {
            if (!gameState.isPlaying || !gameState.timerStarted) return;

            const pauseBtn = document.getElementById('pauseBtn');
            if (gameState.isPaused) {
                // ÁπºÁ∫åÈÅäÊà≤
                gameState.isPaused = false;
                startTimer();
                pauseBtn.textContent = '‚è∏Ô∏è Êö´ÂÅú';
                pauseBtn.classList.remove('paused');
            } else {
                // Êö´ÂÅúÈÅäÊà≤
                gameState.isPaused = true;
                clearInterval(gameState.timerInterval);
                pauseBtn.textContent = '‚ñ∂Ô∏è ÁπºÁ∫å';
                pauseBtn.classList.add('paused');
            }
        }

        function showGameControls(show) {
            document.getElementById('pauseBtn').style.display = show ? 'inline-block' : 'none';
            document.getElementById('restartBtn').style.display = show ? 'inline-block' : 'none';
        }

        function endGame() {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            clearInterval(gameState.timerInterval);
            showGameControls(false);

            // ÈáçÁΩÆÊö´ÂÅúÊåâÈàïÁãÄÊÖã
            const pauseBtn = document.getElementById('pauseBtn');
            pauseBtn.textContent = '‚è∏Ô∏è Êö´ÂÅú';
            pauseBtn.classList.remove('paused');

            // Á¶ÅÁî®ÊèêÁ§∫ÊåâÈàï
            document.getElementById('showHintBtn').disabled = true;

            const accuracy = gameState.correctCount + gameState.wrongCount > 0
                ? Math.round((gameState.correctCount / (gameState.correctCount + gameState.wrongCount)) * 100)
                : 0;

            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalAccuracy').textContent = accuracy;
            document.getElementById('finalCombo').textContent = gameState.maxCombo;

            if (gameState.wrongDrugs.length > 0) {
                const uniqueWrong = [...new Set(gameState.wrongDrugs)];
                const wrongList = uniqueWrong.slice(0, 8).map(name => {
                    const d = drugDatabase.find(x => x.name === name);
                    let loc = `${d.cabinet}Ê´É`;
                    if (d.section) loc += `-${d.section.replace('drawer', 'ÊäΩÂ±ú').replace('door', 'ÈñÄ')}`;
                    else if (d.row) loc += `-${d.row}Ë°å`;
                    return `<li>${name} <span style="color:#666; font-size:0.9em">(${loc})</span></li>`;
                }).join('');

                document.getElementById('errorDrugs').innerHTML =
                    `<div style="text-align:left; margin-top:15px;">
                        <p style="font-weight:bold; color:#d35400;">‚ö†Ô∏è ÈúÄÂä†Âº∑ÁöÑËó•ÂìÅÔºö</p>
                        <ul style="font-size:0.95rem; line-height:1.6; padding-left:20px;">${wrongList}</ul>
                     </div>`;
            } else {
                document.getElementById('errorDrugs').innerHTML = '<p style="color:#27ae60; margin-top:15px;">‚ú® ÂÆåÁæéÔºÅÊ≤íÊúâÈåØË™§Ëó•ÂìÅÔºÅ</p>';
            }

            document.getElementById('resultScreen').classList.add('active');
        }

        function setMode(mode) {
            gameState.mode = mode;
            document.querySelectorAll('.mode-btn-sm').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.mode-btn-sm.${mode}`).classList.add('active');

            // ÂàáÊèõÈ°ØÁ§∫Ê®°Âºè
            const isLocation = (mode === 'location');
            document.getElementById('locationModeRow').style.display = isLocation ? 'flex' : 'none';
            document.getElementById('dispensingModeRow').style.display = isLocation ? 'none' : 'flex';
            clearInlineHint();

            if (gameState.isPlaying) {
                resetGame();
                // Ë®àÊôÇÂô®ÊîπÁÇ∫Á¨¨‰∏ÄÊ¨°‰ΩúÁ≠îÊâçÈñãÂßãÔºå‰∏çÂú®ÈÄôË£°ÂïüÂãï
                nextQuestion();
            }
        }

        // Ë®àÊï∏Âô®Ë™øÊï¥ÂáΩÊï∏
        function adjustCount(type, delta) {
            const elementId = type + 'Count';
            const el = document.getElementById(elementId);
            let val = parseInt(el.textContent) || 0;
            val = Math.max(0, val + delta);
            el.textContent = val;
        }

        function resetCounters() {
            document.getElementById('boxCount').textContent = '0';
            document.getElementById('stripCount').textContent = '0';
            document.getElementById('looseCount').textContent = '0';
        }

        // ==================== È°åÁõÆÈÇèËºØ ====================
        function nextQuestion() {
            if (!gameState.isPlaying) return;

            // Ê∏ÖÈô§ÊâÄÊúâ‰ΩçÁΩÆÊèêÁ§∫È´ò‰∫Æ
            document.querySelectorAll('.slot-blinking').forEach(el => {
                el.classList.remove('slot-blinking');
            });
            document.querySelectorAll('.cabinet-hint-active').forEach(el => {
                el.classList.remove('cabinet-hint-active');
            });

            // Ê∏ÖÈô§Âè≥ÊâãÂçÄËó•ÂìÅÂúñÁâá
            closeDrugImageInPanel();

            const randomIndex = Math.floor(Math.random() * drugDatabase.length);
            gameState.currentDrug = drugDatabase[randomIndex];

            const prescriptionCard = document.querySelector('.prescription-compact');
            if (prescriptionCard) prescriptionCard.classList.remove('position-ok');
            gameState.positionConfirmed = false;
            clearInlineHint();

            if (gameState.mode !== 'location') {
                gameState.currentQuantity = generateQuantity(gameState.currentDrug);
            }

            const drug = gameState.currentDrug;

            if (gameState.mode === 'location') {
                // ÂÆö‰ΩçÊ®°Âºè
                document.getElementById('drugNameLocation').textContent = drug.name;

                // Ê†πÊìöÊèêÁ§∫Ê®°ÂºèÊ±∫ÂÆöÊòØÂê¶È°ØÁ§∫‰ΩçÁΩÆÊèêÁ§∫
                updateHintDisplay();

                // ÂïüÁî®„ÄåÈ°ØÁ§∫‰ΩçÁΩÆÊèêÁ§∫„ÄçÊåâÈàï
                document.getElementById('showHintBtn').disabled = false;
            } else {
                // ÈÖçËó•/Ê∏¨Ë©¶Ê®°Âºè
                document.getElementById('drugNameDispensing').textContent = drug.name;
                document.getElementById('drugQuantityBadge').textContent = `√ó${gameState.currentQuantity}`;
                document.getElementById('specBadge').textContent = `${drug.stripSize}/Êéí ${drug.boxSize}/Áõí`;
            }

            // Update Image
            updateDrugImage(drug.name);


            document.querySelectorAll('.drug-slot').forEach(slot => {
                slot.classList.remove('correct', 'wrong', 'highlight');
            });

            // ÈáçÁΩÆÊ°åÈù¢Ëó•ÂìÅÊ®£Âºè
            document.querySelectorAll('.draggable-drug').forEach(drug => {
                drug.style.outline = '';
                drug.style.animation = '';
            });

            // ÈáçÁΩÆË®àÊï∏Âô®
            resetCounters();

            gameState.questionCount++;
            updateDisplay();
        }

        function showDrugImage(drugName) {
            // Check if drugImageMap is loaded
            if (typeof drugImageMap !== 'undefined' && drugImageMap[drugName]) {
                const rightHandContent = document.getElementById('rightHandContent');

                // Ê∏ÖÈô§ËàäÂÖßÂÆπ‰∏¶È°ØÁ§∫Ëó•ÂìÅÂúñÁâá
                rightHandContent.innerHTML = `
                    <div class="drug-image-container" id="drugImageInPanel">
                        <button class="drug-image-close" onclick="closeDrugImageInPanel()">‚úï</button>
                        <img src="${drugImageMap[drugName]}" alt="${drugName}" class="drug-image-preview">
                        <div class="drug-image-name">${drugName}</div>
                    </div>
                `;
            }
        }

        function closeDrugImageInPanel() {
            const rightHandContent = document.getElementById('rightHandContent');
            rightHandContent.innerHTML = '';
        }

        function toggleDrugImage() {
            const overlay = document.getElementById('drugImageOverlay');
            overlay.style.display = 'none';
        }

        function generateQuantity(drug) {
            const options = [
                drug.stripSize,
                drug.stripSize * 2,
                drug.boxSize,
                drug.boxSize + drug.stripSize,
                Math.floor(drug.stripSize * 1.5),
                drug.stripSize * 3 + Math.floor(drug.stripSize / 2),
            ];
            return options[Math.floor(Math.random() * options.length)];
        }

        // ==================== ‰ΩøÁî®ËÄÖ‰∫íÂãï ====================
        function selectSlot(element) {
            if (!gameState.isPlaying || !gameState.currentDrug) return;

            // Á¨¨‰∏ÄÊ¨°‰ΩúÁ≠îÊôÇÂïüÂãïË®àÊôÇÂô®
            if (!gameState.timerStarted) {
                gameState.timerStarted = true;
                startTimer();
            }

            const cabinet = element.dataset.cabinet;
            const section = element.dataset.section || null;
            const row = element.dataset.row ? parseInt(element.dataset.row) : null;
            const col = parseInt(element.dataset.col);
            const drug = gameState.currentDrug;

            // ÊâæÂà∞Ë¢´ÈªûÊìäÁöÑËó•ÂìÅË≥áÊñô
            const clickedDrug = drugDatabase.find(d => {
                let match = d.cabinet === cabinet && d.col === col;
                if (section) {
                    match = match && d.section === section;
                } else if (row) {
                    match = match && d.row === row && !d.section;
                }
                return match;
            });

            // Êõ¥Êñ∞Ë¶èÊ†ºË≥áË®äÈ°ØÁ§∫ÔºàÈÖçËó•/Ê∏¨Ë©¶Ê®°ÂºèÔºâ
            if (clickedDrug && gameState.mode !== 'location') {
                document.getElementById('specBadge').textContent = `${clickedDrug.stripSize}/Êéí ${clickedDrug.boxSize}/Áõí`;
            }

            let isCorrect = drug.cabinet === cabinet && drug.col === col;
            if (drug.section) {
                isCorrect = isCorrect && drug.section === section;
            } else if (drug.row) {
                isCorrect = isCorrect && drug.row === row;
            }

            if (isCorrect) {
                element.classList.add('correct');
                // Show Image Overlay on Click
                showDrugImage(drug.name);

                if (gameState.mode === 'location') {
                    handleCorrect();
                } else {
                    markPositionConfirmed();
                }
            } else {
                element.classList.add('wrong');
                handleWrong();
                highlightCorrectSlot();
            }
        }

        function markPositionConfirmed() {
            const prescriptionCard = document.querySelector('.prescription-compact');
            if (prescriptionCard) prescriptionCard.classList.add('position-ok');
            gameState.positionConfirmed = true;

            // Á¢∫‰øùË¶èÊ†ºË≥áË®äÊ≠£Á¢∫È°ØÁ§∫ÁÇ∫È°åÁõÆËó•ÂìÅÁöÑË¶èÊ†º
            const drug = gameState.currentDrug;
            if (drug) {
                document.getElementById('specBadge').textContent = `${drug.stripSize}/Êéí ${drug.boxSize}/Áõí`;
            }

            // ‰ΩçÁΩÆÁ¢∫Ë™çÂæåÈáçÁΩÆË®àÊï∏Âô®ÔºåËÆìÁî®Êà∂ÂæûÈõ∂ÈñãÂßãË®àÁÆóÊ≠£Á¢∫ÁöÑËó•ÂìÅ
            resetCounters();
        }

        function highlightCorrectSlot() {
            const drug = gameState.currentDrug;

            // Ê°åÈù¢Ëó•ÂìÅÁâπÊÆäËôïÁêÜ
            if (drug.cabinet === 'Desktop') {
                const correctDrug = document.querySelector(`.draggable-drug[data-drug-name="${drug.name}"]`);
                if (correctDrug) {
                    correctDrug.style.outline = '3px solid #ffc107';
                    correctDrug.style.animation = 'glow 1s infinite';
                }
                return;
            }

            let selector;
            if (drug.section) {
                selector = `[data-cabinet="${drug.cabinet}"][data-section="${drug.section}"][data-col="${drug.col}"]`;
            } else if (drug.row) {
                selector = `[data-cabinet="${drug.cabinet}"][data-row="${drug.row}"][data-col="${drug.col}"]`;
            } else {
                selector = `[data-cabinet="${drug.cabinet}"][data-col="${drug.col}"]`;
            }
            const correctSlot = document.querySelector(selector);
            if (correctSlot) correctSlot.classList.add('highlight');
        }

        function submitDispensing() {
            if (!gameState.isPlaying || !gameState.currentDrug) return;

            if (!gameState.positionConfirmed) {
                handleWrong();
                highlightCorrectSlot();
                showInlineHint('‚úó Ë´ãÂÖàÈªûÈÅ∏Ê≠£Á¢∫‰ΩçÁΩÆ', 'wrong');
                return;
            }

            const boxCount = parseInt(document.getElementById('boxCount').textContent) || 0;
            const stripCount = parseInt(document.getElementById('stripCount').textContent) || 0;
            const looseCount = parseInt(document.getElementById('looseCount').textContent) || 0;

            const drug = gameState.currentDrug;
            const totalDispensed = (boxCount * drug.boxSize) + (stripCount * drug.stripSize) + looseCount;

            if (totalDispensed === gameState.currentQuantity) {
                handleCorrect();
            } else {
                handleWrong();
                showInlineHint(`‚úó È°ÜÊï∏ÈåØË™§ÔºÅÊáâÈÖç ${gameState.currentQuantity} È°Ü`, 'wrong');
            }
        }

        function handleCorrect() {
            gameState.combo++;
            if (gameState.combo > gameState.maxCombo) gameState.maxCombo = gameState.combo;

            const comboBonus = Math.min(gameState.combo * 10, 50);
            const points = 100 + comboBonus;
            gameState.score += points;
            gameState.correctCount++;

            if (gameState.mode === 'location') {
                showFeedback(`‚úì Ê≠£Á¢∫ÔºÅ+${points}`, 'correct');
            } else {
                showInlineHint(`‚úì Ê≠£Á¢∫ÔºÅ+${points}`, 'correct');
            }
            updateDisplay();

            setTimeout(() => {
                if (gameState.mode === 'rush' || gameState.questionCount < gameState.totalQuestions) {
                    nextQuestion();
                } else {
                    endGame();
                }
            }, 700);
        }

        function handleWrong() {
            gameState.combo = 0;
            gameState.wrongCount++;
            gameState.score = Math.max(0, gameState.score - 20);

            if (!gameState.wrongDrugs.includes(gameState.currentDrug.name)) {
                gameState.wrongDrugs.push(gameState.currentDrug.name);
            }

            updateDisplay();

            if (gameState.mode === 'location') {
                showFeedback('‚úó ÈåØË™§ÔºÅ', 'wrong');
                setTimeout(() => {
                    if (gameState.questionCount < gameState.totalQuestions) {
                        nextQuestion();
                    } else {
                        endGame();
                    }
                }, 1200);
            }
        }

        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('combo').textContent = gameState.combo;
            document.getElementById('questionCount').textContent =
                gameState.mode === 'rush'
                    ? `${gameState.correctCount}`
                    : `${gameState.questionCount}/${gameState.totalQuestions}`;
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.style.display = 'block';
            setTimeout(() => { feedback.style.display = 'none'; }, 1200);
        }

        function clearInlineHint() {
            const hint = document.getElementById('inlineHint');
            if (!hint) return;
            hint.textContent = '';
            hint.className = 'inline-hint';
            hint.style.display = 'none';
            if (inlineHintTimeout) clearTimeout(inlineHintTimeout);
            inlineHintTimeout = null;
        }

        function showInlineHint(message, type) {
            const hint = document.getElementById('inlineHint');
            if (!hint) return;
            hint.textContent = message;
            hint.className = `inline-hint show ${type}`;
            hint.style.display = 'block';
            if (inlineHintTimeout) clearTimeout(inlineHintTimeout);
            inlineHintTimeout = setTimeout(() => {
                hint.style.display = 'none';
                hint.className = 'inline-hint';
                hint.textContent = '';
            }, 900);
        }

        init();
    </script>
</body>

</html>